name: ä¾èµ–æ›´æ–°æ£€æŸ¥

on:
  schedule:
    # æ¯å‘¨ä¸€ä¸Šåˆ 9 ç‚¹æ£€æŸ¥ä¾èµ–æ›´æ–°
    - cron: '0 9 * * 1'
  workflow_dispatch:

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    
    steps:
    - name: æ£€å‡ºä»£ç 
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: è®¾ç½® Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: å®‰è£… Rust
      uses: dtolnay/rust-toolchain@stable

    - name: æ£€æŸ¥ npm ä¾èµ–æ›´æ–°
      working-directory: WarpGo-manager
      run: |
        npm outdated || true
        echo "=== å¯ç”¨çš„ npm æ›´æ–° ===" >> ../dependency-report.md
        npm outdated --json >> ../dependency-report.md || true

    - name: æ£€æŸ¥ Cargo ä¾èµ–æ›´æ–°
      working-directory: WarpGo-manager/src-tauri
      run: |
        cargo install cargo-outdated
        echo "=== å¯ç”¨çš„ Cargo æ›´æ–° ===" >> ../../dependency-report.md
        cargo outdated >> ../../dependency-report.md || true

    - name: åˆ›å»º Issueï¼ˆå¦‚æœ‰æ›´æ–°ï¼‰
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          
          if (fs.existsSync('dependency-report.md')) {
            const report = fs.readFileSync('dependency-report.md', 'utf8');
            
            if (report.trim()) {
              await github.rest.issues.create({
                owner: context.repo.owner,
                repo: context.repo.repo,
                title: `ğŸ“¦ ä¾èµ–æ›´æ–°æŠ¥å‘Š - ${new Date().toISOString().split('T')[0]}`,
                body: `## ğŸ”„ ä¾èµ–æ›´æ–°æ£€æŸ¥æŠ¥å‘Š

ä»¥ä¸‹æ˜¯æ£€æµ‹åˆ°çš„å¯ç”¨ä¾èµ–æ›´æ–°ï¼š

\`\`\`
${report}
\`\`\`

### ğŸ“‹ å»ºè®®æ“ä½œ
1. æ£€æŸ¥æ›´æ–°çš„å…¼å®¹æ€§
2. æ›´æ–°ä¾èµ–ç‰ˆæœ¬
3. è¿è¡Œæµ‹è¯•ç¡®ä¿åŠŸèƒ½æ­£å¸¸
4. æäº¤æ›´æ–°

### âš ï¸ æ³¨æ„äº‹é¡¹
- ä¸»è¦ç‰ˆæœ¬æ›´æ–°å¯èƒ½åŒ…å«ç ´åæ€§å˜æ›´
- å»ºè®®å…ˆåœ¨å¼€å‘åˆ†æ”¯æµ‹è¯•
- æ›´æ–°åè®°å¾—è¿è¡Œå®Œæ•´çš„æµ‹è¯•å¥—ä»¶

---
*æ­¤æŠ¥å‘Šç”± GitHub Actions è‡ªåŠ¨ç”Ÿæˆ*`,
                labels: ['dependencies', 'maintenance']
              });
            }
          }
